<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Doc Filler</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
 
    :root{
      --bg:#0d1117;           
      --text:#d0d7de;        
      --muted:#8b98a9;       
      --panel:#111821;
      --glass:rgba(255,255,255,.04); 
      --brand:#6e8efb;        
      --brand-2:#a777e3;     
      --accent:#f5b971;       
      --ok:#58d68d;
      --err:#ff7676;
      --border:#1c2430;
      --radius:18px;
    }
    :root.light{
      --bg:#f5f7fb;
      --text:#0f141b;
      --muted:#5c6472;
      --panel:#ffffff;
      --glass:rgba(0,0,0,.03);
      --brand:#5e7ffb;
      --brand-2:#b089f0;
      --accent:#f7c97a;
      --ok:#22c08a;
      --err:#d74d4d;
      --border:#e5e8ee;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background:var(--bg);
      color:var(--text);
      overflow-x:hidden;
    }

    
    body::before{
      content:"";position:fixed;inset:0;pointer-events:none;z-index:-2;
      background:
        radial-gradient(60vw 40vh at 60% 0%, rgba(110,142,251,.08), transparent 60%),
        radial-gradient(40vw 30vh at 10% 90%, rgba(160,119,227,.07), transparent 60%);
    }

    
    .blob{position:fixed;filter:blur(120px);opacity:.25;z-index:-1;mix-blend-mode:screen}
    .b1{width:44vmax;height:44vmax;background:radial-gradient(closest-side at 40% 40%, rgba(110,142,251,.6), transparent 70%);top:-10vmax;left:-10vmax;animation:float 16s ease-in-out infinite}
    .b2{width:46vmax;height:46vmax;background:radial-gradient(closest-side at 60% 60%, rgba(160,119,227,.55), transparent 72%);right:-12vmax;bottom:-10vmax;animation:float 22s ease-in-out infinite reverse}
    .b3{width:36vmax;height:36vmax;background:radial-gradient(closest-side at 50% 50%, rgba(245,185,113,.45), transparent 65%);left:20vmax;top:40vmax;animation:float 26s ease-in-out infinite}
    @keyframes float{50%{transform:translateY(-2.5vmax) translateX(1.5vmax)}}

  
    .shell{max-width:1100px;margin:32px auto;padding:0 18px}
    .hero{display:flex;align-items:center;gap:14px}
    .logo{width:42px;height:42px;border-radius:12px;background:linear-gradient(135deg,var(--brand),var(--brand-2));box-shadow:0 8px 24px rgba(110,142,251,.28)}
    h1{font-size:28px;margin:0}
    .tiny{font-size:12px}
    .muted{color:var(--muted)}
    .sub{margin:6px 0 22px;color:var(--muted)}

    .rail{display:grid;grid-template-columns:1.15fr .85fr;gap:18px}
    @media (max-width:980px){.rail{grid-template-columns:1fr}}

    .panel{
      position:relative;background:var(--glass);
      border:1px solid var(--border);
      backdrop-filter:blur(18px);-webkit-backdrop-filter:blur(18px);
      border-radius:var(--radius);
      box-shadow:0 12px 40px rgba(0,0,0,.22);
    }
    .panel .head{display:flex;align-items:center;justify-content:space-between;padding:14px 16px;border-bottom:1px dashed var(--border)}
    .panel .body{padding:14px 16px}

    .badge{display:inline-flex;align-items:center;gap:8px;padding:6px 10px;border-radius:999px;border:1px solid var(--border);background:rgba(255,255,255,.03);color:var(--muted);font-size:12px}
    .steps{display:flex;gap:8px;flex-wrap:wrap}
    .step{padding:6px 10px;border-radius:999px;border:1px solid var(--border);color:var(--muted)}
    .step.active{background:linear-gradient(135deg,rgba(110,142,251,.22),rgba(160,119,227,.22));color:white;border-color:transparent}

    
    .drop{display:grid;place-items:center;height:160px;border:1.5px dashed var(--border);border-radius:14px;background:rgba(0,0,0,.12)}
    .drop.drag{border-color:var(--brand);box-shadow:0 0 0 4px rgba(110,142,251,.15) inset}

    .chips{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
    .chip{padding:6px 10px;border-radius:999px;border:1px solid var(--border);background:rgba(0,0,0,.18);color:#cfe1ff;font-size:12px}

    label{display:block;font-size:12px;color:var(--muted);margin:10px 0 6px}
    input[type=text],input[type=date]{
      width:100%;padding:12px 12px;border-radius:12px;border:1px solid var(--border);
      background:rgba(0,0,0,.18);color:var(--text);outline:none
    }
    input:focus{border-color:var(--brand);box-shadow:0 0 0 4px rgba(110,142,251,.15)}

    .grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    @media (max-width:760px){.grid{grid-template-columns:1fr}}

    .actions{display:flex;gap:10px;flex-wrap:wrap}
    button{
      appearance:none;padding:12px 14px;border-radius:12px;border:1px solid var(--border);
      background:rgba(0,0,0,.18);color:var(--text);cursor:pointer;
      transition:transform .05s ease, box-shadow .2s ease, filter .2s ease
    }
    button:hover{filter:brightness(1.05)}
    button:active{transform:translateY(1px)}
    .primary{
      background:linear-gradient(135deg,var(--brand),var(--brand-2));
      border-color:transparent;color:white;
      box-shadow:0 10px 28px rgba(110,142,251,.22), 0 4px 16px rgba(160,119,227,.18)
    }
    .ghost{background:transparent}

    .suggest{min-height:180px}
    .suggest .item{padding:10px;border-radius:12px;background:rgba(0,0,0,.16);border:1px solid var(--border);margin-bottom:10px}
    .status{font-size:12px}

    
    .bar{height:6px;border-radius:999px;background:rgba(255,255,255,.08);overflow:hidden}
    .bar > i{display:block;height:100%;width:0;background:linear-gradient(90deg,var(--brand),var(--brand-2));transition:width .45s ease}

   
    .toggle{cursor:pointer;padding:6px 8px;border-radius:10px;border:1px solid var(--border)}

   
    .confetti{position:fixed;inset:0;pointer-events:none;overflow:hidden}
    .confetti i{position:absolute;width:6px;height:12px;border-radius:2px;opacity:.9}
  </style>
</head>
<body>
  <div class="blob b1"></div>
  <div class="blob b2"></div>
  <div class="blob b3"></div>

  <div class="shell">
    <div class="hero">
      <div class="logo"></div>
      <div>
        <h1>Doc Filler</h1>
        <div class="tiny muted">Upload a SAFE, fill placeholders conversationally, export a clean .docx</div>
      </div>
      <div style="margin-left:auto" class="toggle" id="modeToggle">ðŸŒ™</div>
    </div>

    <div class="steps" style="margin:16px 0 18px">
      <div class="step active" id="stepA">1. Upload</div>
      <div class="step" id="stepB">2. Fill</div>
      <div class="step" id="stepC">3. Download</div>
    </div>

    <div class="rail">
      
      <section class="panel">
        <div class="head">
          <div class="badge">Template: <b id="fileBadge" class="tiny" style="margin-left:6px">None</b></div>
          <div class="bar" style="width:180px"><i id="progress"></i></div>
        </div>
        <div class="body">
          <div id="uploader" class="drop">
            <div class="tiny">
              <div style="font-size:16px;margin-bottom:6px">Drag & drop your .docx here</div>
              <div class="muted">or <u id="pick">browse</u></div>
            </div>
            <input id="file" type="file" accept=".docx" hidden />
          </div>
          <div class="actions" style="margin:12px 0 0">
            <button class="primary" id="detect">Detect Placeholders</button>
            <button class="ghost" id="reset">Reset</button>
          </div>
          <div class="chips" id="chips"></div>

          <div class="divider" style="height:1px;background:var(--border);margin:16px 0"></div>

          <div id="fieldsWrap" style="display:none">
            <div class="actions" style="margin-bottom:8px">
              <button id="autofill" class="ghost">âœ¨ Autofill with AI</button>
              <span id="autoHint" class="tiny muted"></span>
            </div>
            <div class="grid" id="fields"></div>
            <div style="display:flex;align-items:center;gap:10px;margin-top:12px">
              <button id="generate" class="primary">Generate & Download</button>
              <span id="genHint" class="tiny muted"></span>
            </div>
          </div>
        </div>
      </section>

      
      <aside class="panel suggest">
        <div class="head">
          <div class="badge">AI suggestions</div>
          <div class="status muted" id="aiStatus">Idle</div>
        </div>
        <div class="body">
          <div class="actions" style="margin-bottom:10px">
            <button id="suggest">Suggest Questions</button>
          </div>
          <div id="suggestBox" class="muted tiny">No suggestions yet.</div>

          <div class="divider" style="height:1px;background:var(--border);margin:16px 0"></div>
          <div class="badge" style="margin-bottom:8px">Live summary</div>
          <div id="summary" class="tiny muted">Start typing to see a summary.</div>
        </div>
      </aside>
    </div>
  </div>

  <div class="confetti" id="confetti"></div>

  <script>
    
    const toggle = document.getElementById('modeToggle');
    const setMode = (v)=>{ document.documentElement.classList.toggle('light', v==='light'); toggle.textContent = v==='light' ? 'â˜€ï¸' : 'ðŸŒ™'; localStorage.setItem('mode', v); };
    setMode(localStorage.getItem('mode')||'dark');
    toggle.onclick = ()=> setMode(document.documentElement.classList.contains('light')? 'dark':'light');

   
    const $ = (s)=>document.querySelector(s);
    const chips = $('#chips');
    const fields = $('#fields');
    const uploader = $('#uploader');
    const fileInput = $('#file');
    const fileBadge = $('#fileBadge');
    const progress = $('#progress');
    let fileId, filename, labels=[];

    function step(n){
      $('#stepA').classList.toggle('active', n>=1);
      $('#stepB').classList.toggle('active', n>=2);
      $('#stepC').classList.toggle('active', n>=3);
    }

    function setProgress(p){ progress.style.width = (p*100)+'%'; }

    function buildField(label){
      const id = 'f_'+label.replace(/[^a-zA-Z0-9_-]/g,'_');
      const isDate = /date/i.test(label);
      return `<div><label>${label}</label><input ${isDate? 'type="date"':'type="text"'} id="${id}" placeholder="Enter ${label}" /></div>`
    }

    function updateSummary(){
      const s = labels.map(l=>{ const id='f_'+l.replace(/[^a-zA-Z0-9_-]/g,'_'); const v = document.getElementById(id)?.value||''; return v?`<div><b>${l}:</b> ${v}</div>`:''; }).filter(Boolean).join('');
      document.getElementById('summary').innerHTML = s || 'No values yet.';
    }

   
    uploader.addEventListener('dragover', e=>{ e.preventDefault(); uploader.classList.add('drag'); });
    uploader.addEventListener('dragleave', ()=> uploader.classList.remove('drag'));
    uploader.addEventListener('drop', e=>{ e.preventDefault(); uploader.classList.remove('drag');
      const f = e.dataTransfer.files?.[0]; if(f) { fileInput.files = e.dataTransfer.files; fileBadge.textContent = f.name; filename = f.name; }
    });
    document.getElementById('pick').onclick = ()=> fileInput.click();
    fileInput.onchange = ()=>{ const f=fileInput.files?.[0]; if(f){ fileBadge.textContent=f.name; filename=f.name; } };

    
    document.getElementById('detect').onclick = async()=>{
      const f = fileInput.files?.[0]; if(!f) return alert('Choose a .docx first');
      setProgress(0.25); step(1);
      const fd = new FormData(); fd.append('file', f);
      const r = await fetch('/api/fill/detect', { method:'POST', body:fd });
      const j = await r.json(); if(j.error) return alert(j.error);
      fileId=j.fileId; filename=j.filename; labels=j.placeholders||[];
      chips.innerHTML = labels.length? labels.map(x=>`<span class='chip'>${x}</span>`).join('') : `<span class='muted tiny'>No placeholders found</span>`;
      fields.innerHTML = labels.map(buildField).join('');
      document.getElementById('fieldsWrap').style.display = 'block';
      document.querySelectorAll('#fields input').forEach(el=> el.addEventListener('input', updateSummary));
      updateSummary(); setProgress(0.6); step(2);
    };

    
    document.getElementById('reset').onclick = ()=>{
      fileId=filename=undefined; labels=[]; chips.innerHTML=''; fields.innerHTML='';
      document.getElementById('fieldsWrap').style.display = 'none'; fileInput.value=''; fileBadge.textContent='None';
      document.getElementById('autoHint').textContent='';
      document.getElementById('genHint').textContent='';
      document.getElementById('suggestBox').textContent='No suggestions yet.';
      document.getElementById('summary').textContent='Start typing to see a summary.';
      step(1); setProgress(0);
    };

    
    document.getElementById('autofill').onclick = async ()=>{
      if(!labels.length) return alert('Upload a template first.');
      document.getElementById('autoHint').textContent='Thinkingâ€¦';
      try{
        
        const context = 'Y Combinator Post-Money SAFE template; fill obvious business placeholders such as Company Name, Investor Name, State of Incorporation, Governing Law, etc.';
        const r = await fetch('/api/ai/autofill', {
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body: JSON.stringify({ placeholders: labels, context })
        });
        const j = await r.json();
        if(j.error) throw new Error(j.error);

        const suggestions = j.suggestions || {};
        let filled = 0;
        Object.entries(suggestions).forEach(([label, val])=>{
          const id = 'f_'+label.replace(/[^a-zA-Z0-9_-]/g,'_');
          const el = document.getElementById(id);
          if(!el) return;
         
          if(!el.value && typeof val === 'string' && val.trim()){
            el.value = val.trim();
            filled++;
          }
        });
        updateSummary();
        document.getElementById('autoHint').textContent = filled ? `Autofilled ${filled} field(s) âœ“` : 'No fields changed.';
      }catch(err){
        document.getElementById('autoHint').textContent='';
        alert('Autofill failed: ' + (err.message||'Unknown error'));
      }
    };

    
    document.getElementById('suggest').onclick = async()=>{
      if(!labels.length) return alert('Upload a template first.');
      document.getElementById('aiStatus').textContent='Thinkingâ€¦';
      const answers = Object.fromEntries(labels.map(l=>{ const id='f_'+l.replace(/[^a-zA-Z0-9_-]/g,'_'); return [l, document.getElementById(id)?.value]; }).filter(([,v])=>v));
      const r = await fetch('/api/suggest', { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({ placeholders:labels, answers, context:'Y Combinator Post-Money SAFE template' }) });
      const j = await r.json(); const s = j.suggestions||[];
      document.getElementById('aiStatus').textContent = s.length? 'Ready' : 'Idle';
      document.getElementById('suggestBox').innerHTML = s.length ? s.map(x=>{
        if(x.error) return `<div class='tiny' style='color:var(--err)'>${x.error}</div>`;
        const e = x.example? `<div class='tiny muted'>Example: ${x.example}</div>`:'';
        return `<div class='item'><b>${x.label}</b><div>${x.question||''}</div>${e}</div>`;
      }).join('') : '<span class="tiny muted">No suggestions.</span>';
    };

    // -------- Generate --------
    function confetti(){
      const root = document.getElementById('confetti'); root.innerHTML='';
      for(let i=0;i<120;i++){
        const p = document.createElement('i');
        p.style.left = Math.random()*100+'%';
        p.style.top = '-8px';
        p.style.background = `hsl(${Math.random()*360},85%,62%)`;
        const fall = 110 + Math.random()*40;
        p.animate([{ transform:'translateY(0) rotate(0)' },{ transform:`translateY(${fall}vh) rotate(${Math.random()*720-360}deg)` }], { duration: 2200+Math.random()*1200, easing:'cubic-bezier(.2,.6,.2,1)' });
        root.appendChild(p);
        setTimeout(()=>root.removeChild(p), 3500);
      }
    }

    document.getElementById('generate').onclick = async()=>{
      if(!fileId) return alert('Upload a template first.');
      const data={}; labels.forEach(l=>{ const id='f_'+l.replace(/[^a-zA-Z0-9_-]/g,'_'); data[l]=document.getElementById(id)?.value||''; });
      document.getElementById('genHint').textContent='Buildingâ€¦'; setProgress(0.85);
      const r = await fetch('/api/fill/generate', { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({ fileId, data, filename }) });
      if(!r.ok){
        let msg='Failed to generate the document';
        try{ const j=await r.json(); msg = j.error + (j.details? ' â€” '+j.details : ''); }catch{}
        document.getElementById('genHint').textContent=''; return alert(msg);
      }
      const blob = await r.blob();
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href=url; a.download=(filename?.replace(/\.docx$/i,'')||'filled')+'-completed.docx'; a.click(); URL.revokeObjectURL(url);
      document.getElementById('genHint').textContent='Done âœ“'; setProgress(1); step(3); confetti();
    };
  </script>
</body>
</html>
